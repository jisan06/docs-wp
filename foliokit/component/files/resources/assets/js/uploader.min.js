!function(){"use strict";var e,t={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};t.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},s=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(s,(function(e){return t[e]||e})):""}},e=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define((function(){return t})):e.doT=t;var s={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},i=/$^/;function n(e,t,s){return("string"==typeof t?t:t.toString()).replace(e.define||i,(function(t,i,n,o){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in s||(":"===n?(e.defineParams&&o.replace(e.defineParams,(function(e,t,n){s[i]={arg:t,text:n}})),i in s||(s[i]=o)):new Function("def","def['"+i+"']="+o)(s)),""})).replace(e.use||i,(function(t,i){e.useParams&&(i=i.replace(e.useParams,(function(e,t,i,n){if(s[i]&&s[i].arg&&n){var o=(i+":"+n).replace(/'|\\/g,"_");return s.__exp=s.__exp||{},s.__exp[o]=s[i].text.replace(new RegExp("(^|[^\\w$])"+s[i].arg+"([^\\w$])","g"),"$1"+n+"$2"),t+"def.__exp['"+o+"']"}})));var o=new Function("def","return "+i)(s);return o?n(e,o,s):o}))}function o(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}t.template=function(a,r,l){var u,p,d=(r=r||t.templateSettings).append?s.append:s.split,f=0,c=r.use||r.define?n(r,a,l||{}):a;c=("var out='"+(r.strip?c.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):c).replace(/'|\\/g,"\\$&").replace(r.interpolate||i,(function(e,t){return d.start+o(t)+d.end})).replace(r.encode||i,(function(e,t){return u=!0,d.startencode+o(t)+d.end})).replace(r.conditional||i,(function(e,t,s){return t?s?"';}else if("+o(s)+"){out+='":"';}else{out+='":s?"';if("+o(s)+"){out+='":"';}out+='"})).replace(r.iterate||i,(function(e,t,s,i){return t?(f+=1,p=i||"i"+f,t=o(t),"';var arr"+f+"="+t+";if(arr"+f+"){var "+s+","+p+"=-1,l"+f+"=arr"+f+".length-1;while("+p+"<l"+f+"){"+s+"=arr"+f+"["+p+"+=1];out+='"):"';} } out+='"})).replace(r.evaluate||i,(function(e,t){return"';"+o(t)+"out+='"}))+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),u&&(r.selfcontained||!e||e._encodeHTML||(e._encodeHTML=t.encodeHTMLSource(r.doNotSkipEncoded)),c="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+t.encodeHTMLSource.toString()+"("+(r.doNotSkipEncoded||"")+"));"+c);try{return new Function(r.varname,c)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+c),e}},t.compile=function(e,s){return t.template(e,null,s)}}(),function(e,t,s,i,n){var o={};function a(e){return Koowa.translate(e)||e}s.translate=function(e){return a(e)},n.widget("koowa.uploader",{widgetEventPrefix:"uploader:",contents_bak:"",template_cache:{},options:{filters:{prevent_duplicates:!0,image_only:!1},buttons:{browse:!0,start:!0,stop:!0},thumb_width:100,thumb_height:60,headers:{"X-Requested-With":"XMLHttpRequest"},runtimes:"html5,html4",chunking:!1,multi_selection:!0,multiple_queues:!0,dragdrop:!0,drop_element:"body",autostart:!1,rename:!0,preinit:{},templates:{}},IMAGE_EXTENSIONS:["jpg","jpeg","gif","png","tiff","tif","xbm","bmp"],FILE_COUNT_ERROR:-9001,_create:function(){var e=this,t=this.element.attr("id");t||(t=s.guid(),this.element.attr("id",t)),this.id=t,this.contents_bak=this.element.html(),this.element.id=this.element.attr("id"),this.element.addClass("k-upload"),n(".js-uploader-template").each((function(t,s){var i=n(s),o=i.data("name");void 0===e.options.templates[o]&&(e.options.templates[o]=i)}));var i=this.renderTemplate("content-box");i+=this.renderTemplate("error-box"),i+=this.renderTemplate("info-box"),i+=this.renderTemplate("progress-bar"),this.element.html(i);var o=this.options.multi_selection?"multiple":"single";if(n(".js-content",this.element).html(this.renderTemplate("empty-"+o)),this.filelist=n("single"==o?".js-content":".js-filelist-multiple",this.element).attr({id:t+"_filelist",unselectable:"on"}),this.browse_button=n(".js-choose-files",this.element).attr("id",t+"_browse").addClass("disabled"),this.stop_button=n(".js-stop-upload",this.element).attr("id",t+"_stop"),this.start_button=n(".js-start-upload",this.element).attr("id",t+"_start").hide(),this._on({"click .js-clear-queue":function(t){t.preventDefault(),e.clearQueue()},"click .js-open-info":function(t){t.preventDefault(),e.element.toggleClass("has-open-info")},"click .js-remove-file":function(e){e.preventDefault(),n(this).closest("tr").children("td").slideUp("fast")},"click .js-close-error":function(t){t.preventDefault(),e.element.removeClass("has-error")}}),this.browse_button.data("caption-original",this.browse_button.text()),this.progressbar=n(".bar",this.element),this.options.container){var a=this.options.container;if("object"==typeof a.parameters){var r=a.parameters;r.maximum_size&&(this.options.maximum_size=r.maximum_size),"object"==typeof r.allowed_extensions&&(this.options.filters.extensions=r.allowed_extensions),r.maximum_image_size&&(this.options.resize={width:r.maximum_image_size,height:r.maximum_image_size})}this.options.multipart_params.container=a.slug}if(this.options.filters.extensions){var l=this.options.filters.extensions;this.options.filters.image_only&&(l=l.filter((function(t){return-1!=e.IMAGE_EXTENSIONS.indexOf(t)}))),this.options.filters.mime_types=[{title:Koowa.translate("All Files"),extensions:"string"==typeof l?l:l.join(",")}]}this.options.chunking&&(this.options.preinit.Init=this._setChunking),this.options.server_limit||(this.options.server_limit=n.koowa.uploader.server_limit),this._initUploader(),this._setMaxCount(this.options.multi_selection?100:1)},_setChunking:function(e){var t=e.settings.maximum_size,s=e.settings.server_limit;if("html5"===e.runtime&&e.features.chunks){var i=Math.max(1048576,s-1048576);i>33554432&&(i=33554432),e.setOption("chunk_size",i)}else(!t||0==t||t>s)&&(t=s-1048576);t>0&&e.setOption("max_file_size",t)},_setMaxCount:function(e){var t=!1;this.uploader.bind("QueueChanged",(function(s){t||(t=!0,s.splice(0,s.files.length-e),t=!1)}))},_initUploader:function(){var r,l=this,u=this.id,p={container:u,browse_button:u+"_browse"};l.options.dragdrop&&("element"===l.options.drop_element?l.options.drop_element=l.id:"body"===l.options.drop_element&&(l.options.drop_element=t.body),p.drop_element=l.options.drop_element||t.body),this.filelist.on("click",(function(e){n(e.target).hasClass("js-remove-file")&&(l.removeFile(n(e.target).closest(".js-uploader-file").attr("id")),e.preventDefault(),l.uploader.files.length||l.element.removeClass("has-open-info"))})),r=this.uploader=o[u]=new s.Uploader(n.extend(this.options,p)),this.options=r.getOption(),l.options.max_file_count&&s.extend(r.getOption("filters"),{max_file_count:l.options.max_file_count}),s.addFileFilter("max_file_count",(function(e,t,s){e<=this.files.length-(this.total.uploaded+this.total.failed)?(l.disable(),this.trigger("Error",{code:l.FILE_COUNT_ERROR,message:a("File count error."),file:t}),s(!1)):s(!0)})),r.bind("Error",(function(e,t){var n,o="";switch(n="<strong>"+t.message+"</strong>",t.code){case s.FILE_EXTENSION_ERROR:o=i.sprintf(a("File: %s"),t.file.name);break;case s.FILE_SIZE_ERROR:o=i.sprintf(a("File: %s, size: %d, max file size: %d"),t.file.name,s.formatSize(t.file.size),s.formatSize(s.parseSize(e.getOption("filters").max_file_size)));break;case s.FILE_DUPLICATE_ERROR:o=i.sprintf(a("%s already present in the queue."),t.file.name);break;case l.FILE_COUNT_ERROR:o=i.sprintf(a("Upload element accepts only %d file(s) at a time. Extra files were stripped."),e.getOption("filters").max_file_count||0);break;case s.IMAGE_FORMAT_ERROR:o=a("Image format either wrong or not supported.");break;case s.IMAGE_MEMORY_ERROR:o=a("Runtime ran out of available memory.");break;case s.HTTP_ERROR:o=a("Upload URL might be wrong or doesn't exist.")}n+=" <br /><i>"+o+"</i>",l._trigger("error",null,{uploader:e,error:t}),t.code===s.INIT_ERROR?setTimeout((function(){l.destroy()}),1):l.notify("error",n)})),r.bind("PostInit",(function(s){if(l.element.addClass("is-initialized"),l.options.buttons.browse?l._setButtonStatus(l.browse_button,"enable"):(l._setButtonStatus(l.browse_button,"disable"),l.browse_button.hide(),s.disableBrowse(!0)),l.options.buttons.start||(l._setButtonStatus(l.start_button,"disable"),l.start_button.hide()),l.options.buttons.stop||(l._setButtonStatus(l.stop_button,"disable"),l.stop_button.hide()),!l.options.unique_names&&l.options.rename&&l._enableRenaming(),l.options.dragdrop&&s.features.dragdrop&&"iOS"!==i.Env.os){l.element.addClass("has-dragdrop-support");var o=n(l.options.drop_element),a=function(s,i){return{enter:function(e){e.preventDefault(),e.stopPropagation(),s.addClass(i)},leave:function(o){o.stopPropagation();var a=o.originalEvent,r=n(a.target);(r.is(".k-uploader-drop-visual > span")||r.is(".k-uploader-drop-visual")||r.is(t.body)||a.target===e.document)&&s.removeClass(i),(a.offsetX<0||a.offsetY<0)&&(a.relatedTarget||s.removeClass(i)),(0===a.offsetX&&0===a.offsetY||"drop"===o.type)&&s.removeClass(i)}}};if(o.is("body")){var r=l.options.multi_selection?"multiple":"single",u=n(n.trim(l.renderTemplate("drop-message-"+r)));o.append(u);var p=a(u,"is-active");o.on("drop",p.leave),o.on("dragleave",p.leave),o.on("dragenter",p.enter)}else{p=a(o,"has-drag-hover");o.on("drop",p.leave),o.on("dragleave",p.leave),o.on("dragenter",p.enter)}}l.start_button.click((function(e){e.preventDefault(),l.start_button.hasClass("disabled")||l.start()})),l.stop_button.click((function(e){l.stop(),e.preventDefault()})),l._trigger("ready",null,{uploader:s})})),r.init(),r.bind("FileFiltered",(function(e,t){l._addFiles(t)})),r.bind("FilesAdded",(function(e,t){l._trigger("selected",null,{uploader:e,files:t}),l._trigger("updatelist",null,{filelist:l.filelist}),l.options.autostart&&setTimeout((function(){l.start()}),10)})),r.bind("FilesRemoved",(function(e,t){n.each(t,(function(e,t){n("#"+t.id).toggle("highlight",(function(){n(this).remove()}))})),l._trigger("updatelist",null,{filelist:l.filelist}),l._trigger("removed",null,{uploader:e,files:t})})),r.bind("BeforeUpload",(function(e,t){l._trigger("beforeupload",null,{uploader:e,file:t})})),r.bind("QueueChanged",(function(){l._handleState()})),r.bind("StateChanged",(function(e){l._handleState(),s.STARTED===e.state?l._trigger("started",null,{uploader:l.uploader}):s.STOPPED===e.state&&l._trigger("stopped",null,{uploader:l.uploader})}));var d=function(e,t,i){var n=i.response;if(!1===n.status){var o=n.error?n.error:Koowa.translate("Unknown error");l.notify("error",o),l.progressbar.removeClass("bar-success").addClass("bar-danger"),t.error_message=o,t.status=s.FAILED,e.total.uploaded-=1,e.total.failed+=1,e.stop()}};r.bind("ChunkUploaded",d),r.bind("UploadFile",(function(e,t){l._handleFileStatus(t)})),r.bind("FileUploaded",(function(e,t,s){if(void 0!==s.response)try{s.response=n.parseJSON(s.response.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,"")),d(e,t,s)}catch(e){}l._handleFileStatus(t),l._trigger("uploaded",null,{uploader:e,file:t,result:s})})),r.bind("UploadProgress",(function(e,t){l._handleFileStatus(t),l._updateTotalProgress(),l._trigger("progress",null,{uploader:e,file:t})})),r.bind("UploadComplete",(function(e,t){l.progressbar.hasClass("bar-danger")||l.progressbar.addClass("bar-success"),l._trigger("complete",null,{uploader:e,files:t})})),n(e).resize((function(){var e=n(".moxie-shim").position(),t=l.browse_button.position();e&&t&&(Math.abs(e.left-t.left)>2||Math.abs(e.top-t.top)>2)&&r.refresh()}))},_setOption:function(e,t){var s=this;"buttons"==e&&"object"==typeof t&&((t=n.extend(s.options.buttons,t)).browse?(s._setButtonStatus(s.browse_button,"enable"),s.browse_button.show(),s.uploader.disableBrowse(!1)):(s.browse_button.hide(),s._setButtonStatus(s.browse_button,"disable"),s.uploader.disableBrowse(!0)),t.start?(s._setButtonStatus(s.start_button,"enable"),s.options.autostart||s.start_button.show()):(s._setButtonStatus(s.start_button,"disable"),s.start_button.hide()),t.stop?(s._setButtonStatus(s.start_button,"enable"),s.options.autostart||s.start_button.show()):(s._setButtonStatus(s.stop_button,"disable"),s.stop_button.hide())),s.uploader.setOption(e,t)},start:function(){!1!==this._trigger("beforestart",null,{uploader:this.uploader,button:this.start_button})&&(this.uploader.start(),this._trigger("afterstart",null,{uploader:this.uploader,button:this.stop_button}))},stop:function(){!1!==this._trigger("beforestop",null,{uploader:this.uploader,button:this.stop_button})&&(this.uploader.stop(),this._trigger("afterstop",null,{uploader:this.uploader,button:this.stop_button}))},enable:function(){this._setButtonStatus(this.browse_button,"enable"),this.uploader.disableBrowse(!1)},disable:function(){this._setButtonStatus(this.browse_button,"disable"),this.uploader.disableBrowse(!0)},getFile:function(e){return"number"==typeof e?this.uploader.files[e]:this.uploader.getFile(e)},getFiles:function(){return this.uploader.files},removeFile:function(e){"string"===s.typeOf(e)&&(e=this.getFile(e)),this.uploader.removeFile(e)},clearQueue:function(){this.uploader.splice(),this.element.removeClass("has-open-info")},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(e,t){this.element.addClass("has-error"),this.element.find(".js-message-body").html(t)},destroy:function(){this.uploader.destroy(),this.element.empty().removeClass("k-upload").html(this.contents_bak),this.contents_bak="",n.Widget.prototype.destroy.apply(this)},_handleState:function(){var e=this.uploader,t=e.files.length-(e.total.uploaded+e.total.failed),i=e.getOption("filters").max_file_count||0;s.STARTED===e.state?(this.progressbar.removeClass("bar-danger bar-success").parent().addClass("active is-uploading"),this._setButtonStatus(this.start_button,"disable"),this._setButtonStatus(this.stop_button,"enable"),this.options.multiple_queues||this.disable()):s.STOPPED===e.state&&(this.progressbar.parent().removeClass("active is-uploading"),this._setButtonStatus(this.stop_button,"disable"),t?this._setButtonStatus(this.start_button,"enable"):this._setButtonStatus(this.start_button,"disable"),this.options.multiple_queues&&i&&i>t&&this.enable(),e.files.length?!1===this.options.multi_selection?(this.browse_button.text(this.browse_button.data("caption-update")),this.element.addClass("has-file")):(this.options.autostart||this.start_button.show(),this.element.addClass("has-file")):(this.browse_button.text(this.browse_button.data("caption-original")),this.element.removeClass("has-file")),this._updateTotalProgress()),e.refresh()},_setButtonStatus:function(e,t){"enable"===t?e.removeClass("disabled"):e.addClass("disabled"),this.getUploader().refresh()},_handleFileStatus:function(e){var t,i,o=n("#"+e.id);if(o.length){switch(e.status){case s.DONE:i=a("done"),t="is-done";break;case s.FAILED:i=a("failed"),t="is-failed";break;case s.QUEUED:i=a("delete"),t="is-delete";break;case s.UPLOADING:i=a("uploading"),t="is-uploading";var r=n(".plupload_scroll",this.element),l=r.scrollTop(),u=r.height(),p=o.position().top+o.height();u<p&&r.scrollTop(l+p-u)}o.find(".js-file-status").removeClass("is-uploading is-in-queue").addClass(t).text(i),e.error_message&&o.find(".is-failed").css("cursor","pointer").ktooltip({title:e.error_message,placement:"right"})}},_updateTotalProgress:function(){var e,t=this.uploader,i="";this.progressbar.css("width",t.total.percent+"%"),100==t.total.percent&&this.progressbar.parent().removeClass("active"),this.options.multi_selection&&((e=s.STARTED===t.state?"uploading":100==t.total.percent?"upload-finished":t.files.length?"upload-pending":this.options.multi_selection?"empty-multiple":"empty-single")&&(i=this.renderTemplate(e,{percent:t.total.percent,size:s.formatSize(t.total.size),uploaded:t.total.uploaded,total:t.files.length,remaining:t.files.length-(t.total.uploaded+t.total.failed),failed:t.total.failed,uploader:t})),n(".js-content",this.element).html(i))},renderTemplate:function(e,t){if(void 0===this.template_cache[e]){var s=this.options.templates[e];s instanceof n?s=s.text():"function"==typeof s&&(s=s()),this.template_cache[e]=doT.template(s)}return this.template_cache[e](t)},_addFiles:function(e){var t=this,o="";"array"!==s.typeOf(e)&&(e=[e]),n.each(e,(function(e,n){var a=t.options.multi_selection?"multiple-files":"single-file";o+=t.renderTemplate(a,{ext:i.Mime.getFileExtension(n.name)||"",size:n.size?s.formatSize(n.size):"",name:n.name,id:n.id,file:n,uploader:t.getUploader()})})),t.options.multi_selection||t.filelist.empty(),t.filelist.append(o)},_enableRenaming:function(){var e=this;this.filelist.dblclick((function(t){var s,i,o,a=n(t.target),r="";a.hasClass("plupload_file_name_wrapper")&&(o=(s=e.uploader.getFile(a.closest(".plupload_file")[0].id)).name,(i=/^(.+)(\.[^.]+)$/.exec(o))&&(o=i[1],r=i[2]),n('<input class="plupload_file_rename" type="text" />').width(a.width()).insertAfter(a.hide()).val(o).blur((function(){a.show().parent().scrollLeft(0).end().next().remove()})).keydown((function(e){var t=n(this);-1!==n.inArray(e.keyCode,[13,27])&&(e.preventDefault(),13===e.keyCode&&(s.name=t.val()+r,a.html(s.name)),t.blur())}))[0].focus())}))}}),n.koowa.uploader.server_limit=0}(window,document,plupload,mOxie,kQuery),function(e){e.widget("koowa.uploader",e.koowa.uploader,{_init:function(){var e=this._super();return this.options.check_duplicates&&this._on({"uploader:beforestart":this._handleBeforeStart}),e},_handleBeforeStart:function(t,s){var i=[],n=s.uploader,o=this;e.each(n.files,(function(e,t){0==t.loaded&&t.status!=plupload.DONE&&i.push(t.name)}));var a=n.settings.url;a=this.updateUrlParameter(a,"view","files"),a=this.updateUrlParameter(a,"format","json"),a=this.updateUrlParameter(a,"limit","100"),a=this.updateUrlParameter(a,"folder",n.settings.multipart_params.folder),i.length&&e.ajax({url:a,type:"POST",data:{_method:"GET",name:i}}).done((function(t){var s=e.Event("checkDuplicates");s.subject=o,o._trigger("checkDuplicates",s,{uploader:n,response:t,options:o.options}),s.isDefaultPrevented()||o.checkDuplicates(t,n,o.options)})).fail((function(){n.start()})),t.preventDefault()},updateUrlParameter:function(e,t,s){var i=e.indexOf("#"),n=-1===i?"":e.substr(i);e=-1===i?e:e.substr(0,i);var o=new RegExp("([?&])"+t+"=.*?(&|$)","i"),a=-1!==e.indexOf("?")?"&":"?";return(e=e.match(o)?e.replace(o,"$1"+t+"="+s+"$2"):e+a+t+"="+s)+n},getUniqueName:function(e,t){for(var s=1,i=e.substr(e.lastIndexOf(".")+1),n=e.substr(0,e.lastIndexOf("."));t(e=n+" ("+s+")."+i);)s++;return e},getNamesFromArray:function(t){var s=[];return e.each(t,(function(e,t){s.push(t.name)})),s},getConfirmationMessage:function(e){var t="";return 1===e.length?t=Koowa.translate("A file with the same name already exists. Would you like to overwrite it?"):e.length>1&&(t=Koowa.translate("Following files already exist. Would you like to overwrite them? {names}",{names:"\n"+e.join("\n")})),t},makeUnique:function(t,s,i){var n=[];"object"==typeof s.entities&&s.entities.length&&(n=this.getNamesFromArray(s.entities)),e.each(i.files,(function(e,s){s.id!==t.id&&n.push(s.name)})),t.name=this.getUniqueName(t.name,(function(t){return-1!==e.inArray(t,n)})),e("#"+t.id).find("span.js-file-name-container").text(t.name)},checkDuplicates:function(t,s,i){if("object"==typeof t.entities&&t.entities.length){s.settings.multipart_params.overwrite=0;var n=this.getNamesFromArray(t.entities),o=[],a=this,r=void 0===i.duplicate_mode?"confirm":i.duplicate_mode;if("overwrite"===r||"confirm"===r&&confirm(this.getConfirmationMessage(n)))return s.settings.multipart_params.overwrite=1,s.start();e.each(s.files,(function(t,i){if(-1!==e.inArray(i.name,n)){var r,l=s.settings.url;l=a.updateUrlParameter(l,"view","files"),l=a.updateUrlParameter(l,"format","json"),l=a.updateUrlParameter(l,"limit","100"),l=a.updateUrlParameter(l,"folder",s.settings.multipart_params.folder),l=a.updateUrlParameter(l,"search",i.name.substr(0,i.name.lastIndexOf("."))+" ("),r=e.ajax({type:"GET",url:l}).done((function(e){return a.makeUnique(i,e,s)})),o.push(r)}})),o&&e.when.apply(kQuery,o).then((function(){s.start()}))}else s.start()}})}(kQuery);